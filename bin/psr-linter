#!/usr/bin/env php

<?php

require_once __DIR__ . '/../vendor/autoload.php';

use \Commando\Command;
use function \PsrLinter\lintCli;
use function \PsrLinter\reportText;

$cmd = new Commando\Command();

$cmd->option()
    ->require(true)
    ->describedAs('One or more files and/or directories to check')
    ->expectsFile()
    ->flag('fix')
    ->describedAs('fix violations')
    ->boolean()
    ->setHelp('Validate php files according PSR2 standards' . PHP_EOL . PHP_EOL. 'Usage: psr-linter <file>');

$flags = $cmd->getFlagValues();
$options = ['fixerEnabled' => $flags['fix']];
$errors = lintCli($cmd[0], $options);

if ($errors) {
    file_put_contents('php://stderr', reportText($errors));
    exit(1);
}

exit(0);
